require_relative './config/environment'
require 'sinatra/activerecord/rake'
# task :foo_task => [:environment] do
desc "Runs a Pry console"
task :console do
  ActiveRecord::Base.logger = Logger.new(STDOUT)
  
  # Open a Pry session
  Pry.start
end
task :scrape_jumia => [:environment]  do
  require_relative './lib/jumia'
  require 'pry'
  require 'securerandom'
  jum = JumiaScraper.new
  jum.get_categories
  jum.get_category_urls
  jum.product_details.each do |product|
    price_effective = product[:price_effective].to_s.scan(/\d/).join('')
    price_full = product[:price_full].to_s.scan(/\d/).join('')

    ProductDetail.create(detail_id:SecureRandom.uuid.to_s, 
                         categories:product[:categories], 
                        price_effective:price_effective)
    # TODO: Add a buy column on each product with the url to purchase
    Product.create(product_id: product[:product_id].to_s,
                   product_name: product[:name].to_s, 
                   vendor:"Jumia", 
                   product_image_url: product[:image_url].to_s,
                   product_url: product[:href].to_s
                   )
  end

end
task :scrape_kilimall do
  require_relative './lib/kilimall'
  require 'pry'
  kili = KilimallScraper.new
  kili_content = kili.get_page()
  kili_categories = kili.get_categories(kili_content)
  binding.pry
  end
